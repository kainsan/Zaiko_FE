<div class="modal-container" *ngIf="product?.productEntity">
  <form [formGroup]="productForm">
    <!-- Header with Tabs -->
    <div class="modal-header">
      <div class="tabs-container">
        <!-- General Tab -->
        <div (click)="selectTab('general')" class="tab-item" [ngClass]="{
          'active': activeTab === 'general',
          'inactive': activeTab !== 'general'
        }">
          一般
        </div>
        <!-- Packaging Tab -->
        <div (click)="selectTab('packaging')" class="tab-item" [ngClass]="{
          'active': activeTab === 'packaging',
          'inactive': activeTab !== 'packaging'
        }">
          荷姿
        </div>
        <!-- Stock Tab -->
        <div (click)="selectTab('stock')" class="tab-item" [ngClass]="{
          'active': activeTab === 'stock',
          'inactive': activeTab !== 'stock'
        }">
          在庫
        </div>
      </div>

      <!-- Close Button (Top Right) -->
      <button class="close-btn" (click)="onClose()">
        <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M6.72656 4.89453L9.46094 7.65625C9.81641 7.98438 9.81641 8.53125 9.46094 8.85938L8.85938 9.46094C8.53125 9.81641 7.98438 9.81641 7.65625 9.46094L4.92188 6.72656L2.16016 9.46094C1.83203 9.81641 1.28516 9.81641 0.957031 9.46094L0.355469 8.85938C0 8.53125 0 7.98438 0.355469 7.65625L3.08984 4.89453L0.355469 2.16016C0 1.83203 0 1.28516 0.355469 0.957031L0.957031 0.355469C1.28516 0 1.83203 0 2.16016 0.355469L4.92188 3.08984L7.65625 0.355469C7.98438 0 8.53125 0 8.85938 0.355469L9.46094 0.957031C9.81641 1.28516 9.81641 1.83203 9.46094 2.16016L6.72656 4.89453Z"
            fill="#4392BB" />
        </svg>
      </button>
    </div>

    <!-- Tab Content Area -->
    <div class="content-area">
      <!-- General Tab Content -->
      <div *ngIf="activeTab === 'general'" class="tab-content general">
        <!-- Code and UPC -->
        <div class="top-row-group">
          <div class="form-group code-group">
            <label>商品コード <span class="required">*</span></label>
            <input type="text" class="read-only" readonly formControlName="productCode" />
          </div>
          <div class="form-group upc-group">
            <label>UPC1</label>
            <input type="text" formControlName="upcCd1" />
          </div>
          <div class="form-group upc-group">
            <label>UPC2</label>
            <input type="text" formControlName="upcCd2" />
          </div>
        </div>
        <div class="checkbox-row section-divider">
          <div class="checkbox-group">
            <input type="checkbox" id="isSet" formControlName="isSet" />
            <label for="isSet">セット品</label>
          </div>
        </div>

        <!-- Name Fields -->
        <div class="form-group section-divider no-border">
          <label>名称</label>
          <input type="text" formControlName="name1" />
          <input type="text" formControlName="name2" />
          <input type="text" formControlName="name3" />
          <input type="text" formControlName="name4" />
          <input type="text" formControlName="name5" />
        </div>

        <!-- Spec -->
        <div class="form-group section-divider">
          <label>規格</label>
          <input type="text" formControlName="standardInfo" />
        </div>

        <!-- Categories -->
        <div class="form-grid-2 section-divider">
          <!-- Category 1 -->
          <div class="form-group">
            <label>商品分類コード 1</label>
            <div class="input-with-button">
              <div class="relative-wrapper">
                <input type="text" class="small-input" formControlName="categoryCode1" />
                <button class="icon-btn" (click)="openCategorySearch('cat1')">
                  <svg width="10" height="10" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M5.91797 5.19141C6.02344 5.30859 6.02344 5.48438 5.90625 5.58984L5.57812 5.91797C5.47266 6.03516 5.29688 6.03516 5.17969 5.91797L4.01953 4.75781C3.96094 4.69922 3.9375 4.62891 3.9375 4.55859V4.35938C3.51562 4.6875 3 4.875 2.4375 4.875C1.08984 4.875 0 3.78516 0 2.4375C0 1.10156 1.08984 0 2.4375 0C3.77344 0 4.875 1.10156 4.875 2.4375C4.875 3.01172 4.67578 3.52734 4.35938 3.9375H4.54688C4.61719 3.9375 4.6875 3.97266 4.74609 4.01953L5.91797 5.19141ZM2.4375 3.9375C3.25781 3.9375 3.9375 3.26953 3.9375 2.4375C3.9375 1.61719 3.25781 0.9375 2.4375 0.9375C1.60547 0.9375 0.9375 1.61719 0.9375 2.4375C0.9375 3.26953 1.60547 3.9375 2.4375 3.9375Z"
                      fill="white" />
                  </svg>
                </button>
              </div>
              <input type="text" class="flex-input" readonly formControlName="categoryName1" />
            </div>
          </div>
          <!-- Category 2 -->
          <div class="form-group">
            <label>商品分類コード 2</label>
            <div class="input-with-button">
              <div class="relative-wrapper">
                <input type="text" class="small-input" formControlName="categoryCode2" />
                <button class="icon-btn" (click)="openCategorySearch('cat2')">
                  <svg width="7" height="7" viewBox="0 0 7 7" fill="red" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M5.91797 5.19141C6.02344 5.30859 6.02344 5.48438 5.90625 5.58984L5.57812 5.91797C5.47266 6.03516 5.29688 6.03516 5.17969 5.91797L4.01953 4.75781C3.96094 4.69922 3.9375 4.62891 3.9375 4.55859V4.35938C3.51562 4.6875 3 4.875 2.4375 4.875C1.08984 4.875 0 3.78516 0 2.4375C0 1.10156 1.08984 0 2.4375 0C3.77344 0 4.875 1.10156 4.875 2.4375C4.875 3.01172 4.67578 3.52734 4.35938 3.9375H4.54688C4.61719 3.9375 4.6875 3.97266 4.74609 4.01953L5.91797 5.19141ZM2.4375 3.9375C3.25781 3.9375 3.9375 3.26953 3.9375 2.4375C3.9375 1.61719 3.25781 0.9375 2.4375 0.9375C1.60547 0.9375 0.9375 1.61719 0.9375 2.4375C0.9375 3.26953 1.60547 3.9375 2.4375 3.9375Z"
                      fill="white" />
                  </svg>
                </button>
              </div>
              <input type="text" class="flex-input" readonly formControlName="categoryName2" />
            </div>
          </div>
          <!-- Category 3 -->
          <div class="form-group">
            <label>商品分類コード 3</label>
            <div class="input-with-button">
              <div class="relative-wrapper">
                <input type="text" class="small-input" formControlName="categoryCode3" />
                <button class="icon-btn" (click)="openCategorySearch('cat3')">
                  <svg width="10" height="10" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M5.91797 5.19141C6.02344 5.30859 6.02344 5.48438 5.90625 5.58984L5.57812 5.91797C5.47266 6.03516 5.29688 6.03516 5.17969 5.91797L4.01953 4.75781C3.96094 4.69922 3.9375 4.62891 3.9375 4.55859V4.35938C3.51562 4.6875 3 4.875 2.4375 4.875C1.08984 4.875 0 3.78516 0 2.4375C0 1.10156 1.08984 0 2.4375 0C3.77344 0 4.875 1.10156 4.875 2.4375C4.875 3.01172 4.67578 3.52734 4.35938 3.9375H4.54688C4.61719 3.9375 4.6875 3.97266 4.74609 4.01953L5.91797 5.19141ZM2.4375 3.9375C3.25781 3.9375 3.9375 3.26953 3.9375 2.4375C3.9375 1.61719 3.25781 0.9375 2.4375 0.9375C1.60547 0.9375 0.9375 1.61719 0.9375 2.4375C0.9375 3.26953 1.60547 3.9375 2.4375 3.9375Z"
                      fill="white" />
                  </svg>
                </button>
              </div>
              <input type="text" class="flex-input" readonly formControlName="categoryName3" />
            </div>
          </div>
          <!-- Category 4 -->
          <div class="form-group">
            <label>商品分類コード 4</label>
            <div class="input-with-button">
              <div class="relative-wrapper">
                <input type="text" class="small-input" formControlName="categoryCode4" />
                <button class="icon-btn" (click)="openCategorySearch('cat4')">
                  <svg width="10" height="10" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M5.91797 5.19141C6.02344 5.30859 6.02344 5.48438 5.90625 5.58984L5.57812 5.91797C5.47266 6.03516 5.29688 6.03516 5.17969 5.91797L4.01953 4.75781C3.96094 4.69922 3.9375 4.62891 3.9375 4.55859V4.35938C3.51562 4.6875 3 4.875 2.4375 4.875C1.08984 4.875 0 3.78516 0 2.4375C0 1.10156 1.08984 0 2.4375 0C3.77344 0 4.875 1.10156 4.875 2.4375C4.875 3.01172 4.67578 3.52734 4.35938 3.9375H4.54688C4.61719 3.9375 4.6875 3.97266 4.74609 4.01953L5.91797 5.19141ZM2.4375 3.9375C3.25781 3.9375 3.9375 3.26953 3.9375 2.4375C3.9375 1.61719 3.25781 0.9375 2.4375 0.9375C1.60547 0.9375 0.9375 1.61719 0.9375 2.4375C0.9375 3.26953 1.60547 3.9375 2.4375 3.9375Z"
                      fill="white" />
                  </svg>
                </button>
              </div>
              <input type="text" class="flex-input" readonly formControlName="categoryName4" />
            </div>
          </div>
          <!-- Category 5 -->
          <div class="form-group">
            <label>商品分類コード 5</label>
            <div class="input-with-button">
              <div class="relative-wrapper">
                <input type="text" class="small-input" formControlName="categoryCode5" />
                <button class="icon-btn" (click)="openCategorySearch('cat5')">
                  <svg width="10" height="10" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M5.91797 5.19141C6.02344 5.30859 6.02344 5.48438 5.90625 5.58984L5.57812 5.91797C5.47266 6.03516 5.29688 6.03516 5.17969 5.91797L4.01953 4.75781C3.96094 4.69922 3.9375 4.62891 3.9375 4.55859V4.35938C3.51562 4.6875 3 4.875 2.4375 4.875C1.08984 4.875 0 3.78516 0 2.4375C0 1.10156 1.08984 0 2.4375 0C3.77344 0 4.875 1.10156 4.875 2.4375C4.875 3.01172 4.67578 3.52734 4.35938 3.9375H4.54688C4.61719 3.9375 4.6875 3.97266 4.74609 4.01953L5.91797 5.19141ZM2.4375 3.9375C3.25781 3.9375 3.9375 3.26953 3.9375 2.4375C3.9375 1.61719 3.25781 0.9375 2.4375 0.9375C1.60547 0.9375 0.9375 1.61719 0.9375 2.4375C0.9375 3.26953 1.60547 3.9375 2.4375 3.9375Z"
                      fill="white" />
                  </svg>
                </button>
              </div>
              <input type="text" class="flex-input" readonly formControlName="categoryName5" />
            </div>
          </div>
        </div>

        <!-- Summary -->
        <div class="form-group section-divider no-border">
          <label>摘要</label>
          <textarea formControlName="notes"></textarea>
        </div>
      </div>

      <!-- Packaging Tab Content -->
      <div *ngIf="activeTab === 'packaging'" class="tab-content packaging">
        <div class="form-grid-3 section-divider">
          <div class="form-group">
            <label>商品コード <span class="required">*</span></label>
            <input type="text" class="read-only" readonly formControlName="productCode" />
          </div>
          <div class="form-group">
            <label>UPC1</label>
            <input type="text" class="read-only" readonly formControlName="upcCd1" />
          </div>
          <div class="form-group">
            <label>UPC2</label>
            <input type="text" class="read-only" readonly formControlName="upcCd2" />
          </div>
        </div>

        <div class="packaging-options">
          <div class="section-label">ＦＩＦＯ</div>
          <div class="checkbox-group option-row indent-1">
            <input type="radio" value="0" formControlName="fifoType" id="fifo" />
            <span>ファーストイン・ファーストアウト（先入先出）引当をする</span>
          </div>
          <div class="checkbox-group option-row indent-1">
            <input type="radio" value="1" formControlName="fifoType" id="lifo" />
            <span>ラストイン・ファーストアウト（後入先出）引当をする</span>
          </div>
        </div>

        <div class="packaging-options">
          <div class="section-label">ロット管理</div>
          <div class="checkbox-group option-row indent-1">
            <input type="checkbox" name="lot" id="lot" formControlName="isDateTimeMng" />
            <span>管理日付で管理をする {{product.productEntity.isDateTimeMng}}</span>
          </div>
          <div class="checkbox-group option-row indent-2">
            <input type="radio" id="lot-in" value="0" formControlName="dateTimeMngType" />
            <span>入庫日管理をする</span>
          </div>
          <div class="checkbox-group option-row indent-2">
            <input type="radio" id="lot-mfg" value="1" formControlName="dateTimeMngType" />
            <span>製造年月日管理をする</span>
          </div>
          <div class="checkbox-group option-row indent-2">
            <input type="radio" id="lot-exp" value="2" formControlName="dateTimeMngType" />
            <span>賞味期限管理をする</span>
          </div>
          <div class="checkbox-group option-row indent-1">
            <input type="checkbox" name="lot-no" formControlName="isNumberMng" />
            <span>管理番号で管理をする</span>
          </div>
        </div>

        <div class="packaging-options">
          <div class="section-label">重量・容積</div>
          <div class="weight-volume-group">
            <div class="group-content">
              <div class="group-label">マスターカートン</div>
              <div class="sub-group">
                <div class="form-group">
                  <label>重量（単位）</label>
                  <div class="input-row">
                    <input type="text" formControlName="cartonWeight" />
                    <input type="text" formControlName="cartonWeightName" />
                  </div>
                </div>
              </div>
              <div class="sub-group">
                <div class="form-group">
                  <label>容積（単位）</label>
                  <div class="input-row">
                    <input type="text" formControlName="cartonVolume" />
                    <input type="text" formControlName="cartonVolumeName" />
                  </div>
                </div>
              </div>
              <div class="sub-group">
                <div class="form-group">
                  <label>縦ｘ横ｘ高</label>
                  <div class="dimension-row">
                    <input type="text" formControlName="cartonHigh" />
                    <svg width="7" height="7" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M-1.94311e-05 6.7439H1.83598L2.62798 5.5079C2.84398 5.1119 3.08398 4.7159 3.29998 4.3319H3.34798C3.61198 4.7159 3.91198 5.1239 4.16398 5.5079L5.03998 6.7439H6.94798L4.53598 3.4319L6.77998 -0.000103951H4.94398L4.23598 1.1999C4.04398 1.5719 3.82798 1.9799 3.62398 2.3519H3.57598C3.34798 1.9799 3.07198 1.5719 2.85598 1.2119L2.06398 -0.000103951H0.167981L2.38798 3.2399L-1.94311e-05 6.7439Z"
                        fill="#485764" />
                    </svg>
                    <input type="text" formControlName="cartonHorizontal" />
                    <svg width="7" height="7" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M-1.94311e-05 6.7439H1.83598L2.62798 5.5079C2.84398 5.1119 3.08398 4.7159 3.29998 4.3319H3.34798C3.61198 4.7159 3.91198 5.1239 4.16398 5.5079L5.03998 6.7439H6.94798L4.53598 3.4319L6.77998 -0.000103951H4.94398L4.23598 1.1999C4.04398 1.5719 3.82798 1.9799 3.62398 2.3519H3.57598C3.34798 1.9799 3.07198 1.5719 2.85598 1.2119L2.06398 -0.000103951H0.167981L2.38798 3.2399L-1.94311e-05 6.7439Z"
                        fill="#485764" />
                    </svg>
                    <input type="text" formControlName="cartonVertical" />
                  </div>
                </div>
              </div>
            </div>

            <div class="group-content">
              <div class="group-label">ピース</div>
              <div class="sub-group">
                <div class="form-group">
                  <label>重量（単位）</label>
                  <div class="input-row">
                    <input type="text" formControlName="pieceWeight" />
                    <input type="text" formControlName="pieceWeightName" />
                  </div>
                </div>
              </div>
              <div class="sub-group">
                <div class="form-group">
                  <label>容積（単位）</label>
                  <div class="input-row">
                    <input type="text" formControlName="pieceVolume" />
                    <input type="text" formControlName="pieceVolumeName" />
                  </div>
                </div>
              </div>
              <div class="sub-group">
                <div class="form-group">
                  <label>縦ｘ横ｘ高</label>
                  <div class="dimension-row">
                    <input type="text" formControlName="cartonHigh" />
                    <svg width="7" height="7" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M-1.94311e-05 6.7439H1.83598L2.62798 5.5079C2.84398 5.1119 3.08398 4.7159 3.29998 4.3319H3.34798C3.61198 4.7159 3.91198 5.1239 4.16398 5.5079L5.03998 6.7439H6.94798L4.53598 3.4319L6.77998 -0.000103951H4.94398L4.23598 1.1999C4.04398 1.5719 3.82798 1.9799 3.62398 2.3519H3.57598C3.34798 1.9799 3.07198 1.5719 2.85598 1.2119L2.06398 -0.000103951H0.167981L2.38798 3.2399L-1.94311e-05 6.7439Z"
                        fill="#485764" />
                    </svg>
                    <input type="text" formControlName="cartonHorizontal" />
                    <svg width="7" height="7" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M-1.94311e-05 6.7439H1.83598L2.62798 5.5079C2.84398 5.1119 3.08398 4.7159 3.29998 4.3319H3.34798C3.61198 4.7159 3.91198 5.1239 4.16398 5.5079L5.03998 6.7439H6.94798L4.53598 3.4319L6.77998 -0.000103951H4.94398L4.23598 1.1999C4.04398 1.5719 3.82798 1.9799 3.62398 2.3519H3.57598C3.34798 1.9799 3.07198 1.5719 2.85598 1.2119L2.06398 -0.000103951H0.167981L2.38798 3.2399L-1.94311e-05 6.7439Z"
                        fill="#485764" />
                    </svg>
                    <input type="text" formControlName="cartonVertical" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="packaging-options">
          <div class="section-label">荷姿</div>
          <table class="packaging-table">
            <colgroup>
              <col style="width: 140px;">
              <col style="width: 50px;">
              <col style="width: 50px;">
              <col style="width: 120px;">
              <col style="width: 70px;">
              <col style="width: auto;">
            </colgroup>
            <thead>
              <tr>
                <th></th>
                <th class="center w-20">入庫</th>
                <th class="center w-20">出庫</th>
                <th>単位名称</th>
                <th colspan="2">入数／積付数</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>マスターカートン</td>
                <td class="center">
                  <div class="checkbox-group justify-center">
                    <input type="checkbox" formControlName="isPackCsInput" />
                  </div>
                </td>
                <td class="center">
                  <div class="checkbox-group justify-center">
                    <input type="checkbox" formControlName="isPackCsOutput" />
                  </div>
                </td>
                <td>
                  <div class="unit-input-wrapper">
                    <input type="text" readonly formControlName="packagingCsUnitName" />
                    <input type="hidden" formControlName="packagingCsUnitCode" />
                    <button (click)="openPackagingCodeSearch('Cs')"
                      [disabled]="!productForm.get('isPackCsInput')?.value && !productForm.get('isPackCsOutput')?.value">
                      <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                          d="M9.66797 8.75391C9.84375 8.92969 9.84375 9.22266 9.66797 9.39844L9.375 9.69141C9.19922 9.86719 8.90625 9.86719 8.73047 9.69141L6.94336 7.9043C6.88477 7.8457 6.85547 7.75781 6.85547 7.66992V7.49414C6.24023 7.96289 5.47852 8.25586 4.62891 8.25586C2.60742 8.25586 0.966797 6.61523 0.966797 4.59375C0.966797 2.57227 2.60742 0.931641 4.62891 0.931641C6.65039 0.931641 8.29102 2.57227 8.29102 4.59375C8.29102 5.44336 7.99805 6.20508 7.5293 6.82031H7.70508C7.79297 6.82031 7.88086 6.84961 7.93945 6.9082L9.66797 8.75391ZM4.62891 6.82031C5.85938 6.82031 6.85547 5.82422 6.85547 4.59375C6.85547 3.36328 5.85938 2.36719 4.62891 2.36719C3.39844 2.36719 2.40234 3.36328 2.40234 4.59375C2.40234 5.82422 3.39844 6.82031 4.62891 6.82031Z"
                          fill="white" />
                      </svg>
                    </button>
                  </div>
                </td>
                <td class="no-padding">
                  <input type="text" [value]="packagingCsUnitAmount()" class="qty-input"
                    formControlName="packagingCsUnitAmount" />
                </td>
                <td class="no-padding">
                  <input type="text" value="マスターカートン／インナーカートン" readonly class="ratio-display" />
                </td>
              </tr>
              <tr class="bg-alt">
                <td>インナーカートン</td>
                <td class="center">
                  <div class="checkbox-group justify-center">
                    <input type="checkbox" formControlName="isPackBlInput" />
                  </div>
                </td>
                <td class="center">
                  <div class="checkbox-group justify-center">
                    <input type="checkbox" formControlName="isPackBlOutput" />
                  </div>
                </td>
                <td>
                  <div class="unit-input-wrapper">
                    <input type="text" readonly formControlName="packagingBlUnitName" />
                    <input type="hidden" formControlName="packagingBlUnitCode" />
                    <button (click)="openPackagingCodeSearch('Bl')"
                      [disabled]="!productForm.get('isPackBlInput')?.value && !productForm.get('isPackBlOutput')?.value">
                      <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                          d="M9.66797 8.75391C9.84375 8.92969 9.84375 9.22266 9.66797 9.39844L9.375 9.69141C9.19922 9.86719 8.90625 9.86719 8.73047 9.69141L6.94336 7.9043C6.88477 7.8457 6.85547 7.75781 6.85547 7.66992V7.49414C6.24023 7.96289 5.47852 8.25586 4.62891 8.25586C2.60742 8.25586 0.966797 6.61523 0.966797 4.59375C0.966797 2.57227 2.60742 0.931641 4.62891 0.931641C6.65039 0.931641 8.29102 2.57227 8.29102 4.59375C8.29102 5.44336 7.99805 6.20508 7.5293 6.82031H7.70508C7.79297 6.82031 7.88086 6.84961 7.93945 6.9082L9.66797 8.75391ZM4.62891 6.82031C5.85938 6.82031 6.85547 5.82422 6.85547 4.59375C6.85547 3.36328 5.85938 2.36719 4.62891 2.36719C3.39844 2.36719 2.40234 3.36328 2.40234 4.59375C2.40234 5.82422 3.39844 6.82031 4.62891 6.82031Z"
                          fill="white" />
                      </svg>
                    </button>
                  </div>
                </td>
                <td class="no-padding">
                  <input type="text" [value]="packagingBlUnitAmount()" class="qty-input"
                    formControlName="packagingBlUnitAmount" />
                </td>
                <td class="no-padding">
                  <input type="text" value="インナーカートン／ピース" readonly class="ratio-display" />
                </td>
              </tr>
              <tr>
                <td>ピース</td>
                <td class="center">
                  <div class="checkbox-group justify-center">
                    <input type="checkbox" formControlName="isPieceInput" />
                  </div>
                </td>
                <td class="center">
                  <div class="checkbox-group justify-center">
                    <input type="checkbox" formControlName="isPieceOutput" />
                  </div>
                </td>
                <td>
                  <div class="unit-input-wrapper">
                    <input type="text" readonly formControlName="packagingPieceUnitName" />
                    <input type="hidden" formControlName="packagingPieceUnitCode" />
                    <button (click)="openPackagingCodeSearch('Piece')"
                      [disabled]="!productForm.get('isPieceInput')?.value && !productForm.get('isPieceOutput')?.value">
                      <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                          d="M9.66797 8.75391C9.84375 8.92969 9.84375 9.22266 9.66797 9.39844L9.375 9.69141C9.19922 9.86719 8.90625 9.86719 8.73047 9.69141L6.94336 7.9043C6.88477 7.8457 6.85547 7.75781 6.85547 7.66992V7.49414C6.24023 7.96289 5.47852 8.25586 4.62891 8.25586C2.60742 8.25586 0.966797 6.61523 0.966797 4.59375C0.966797 2.57227 2.60742 0.931641 4.62891 0.931641C6.65039 0.931641 8.29102 2.57227 8.29102 4.59375C8.29102 5.44336 7.99805 6.20508 7.5293 6.82031H7.70508C7.79297 6.82031 7.88086 6.84961 7.93945 6.9082L9.66797 8.75391ZM4.62891 6.82031C5.85938 6.82031 6.85547 5.82422 6.85547 4.59375C6.85547 3.36328 5.85938 2.36719 4.62891 2.36719C3.39844 2.36719 2.40234 3.36328 2.40234 4.59375C2.40234 5.82422 3.39844 6.82031 4.62891 6.82031Z"
                          fill="white" />
                      </svg>
                    </button>
                  </div>
                </td>
                <td class="no-padding text-gray-500" style="padding-left: 8px;">
                  <span>-</span>
                </td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Stock Tab Content -->
      <div *ngIf="activeTab === 'stock'" class="tab-content stock">
        <!-- Top Row: Product Code, UPC1, UPC2 -->
        <div class="form-grid-3 section-divider">
          <div class="form-group code-group">
            <label>商品コード <span class="required">*</span></label>
            <input type="text" class="read-only" readonly formControlName="productCode" />
          </div>
          <div class="form-group upc-group">
            <label>UPC1</label>
            <input type="text" class="read-only" readonly formControlName="upcCd1" />
          </div>
          <div class="form-group upc-group">
            <label>UPC2</label>
            <input type="text" class="read-only" readonly formControlName="upcCd2" />
          </div>
        </div>

        <!-- Warehouse and Location -->
        <div class="form-grid-2 section-divider">
          <div class="form-group">
            <label>推奨倉庫</label>
            <select class="select-arrow" (change)="onWarehouseChange($event)" formControlName="repositoryId">
              <option value="">選択</option>
              <option *ngFor="let repo of repositories()" [value]="repo.repositoryId">
                {{repo.repositoryCode}}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>推奨ロケーション</label>
            <select class="select-arrow" formControlName="locationId">
              <option value="">選択</option>
              <option *ngFor="let loc of locations()" [value]="loc.locationId">
                {{loc.locationCode}}
              </option>
            </select>
          </div>
        </div>

        <!-- Replenishment Management -->
        <div class="form-grid-3 section-divider">
          <div class="form-group">
            <label>補充管理</label>
            <div class="radio-group-row">
              <div class="radio-item">
                <input type="radio" id="rep-do" value="1" formControlName="isReplenishMng" />
                <label for="rep-do">する</label>
              </div>
              <div class="radio-item">
                <input type="radio" id="rep-dont" value="0" formControlName="isReplenishMng" />
                <label for="rep-dont">しない</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>補充点</label>
            <input type="text" formControlName="minInventoryQuantity" class="text-right" />
          </div>
          <div class="form-group">
            <label>最低補充数（バラ）</label>
            <input type="text" formControlName="minInputQuantity" class="text-right" />
          </div>
        </div>

        <!-- Expenses -->
        <div class="checkbox-row section-divider">
          <div class="checkbox-group">
            <input type="checkbox" id="expenses" />
            <label for="expenses">諸掛</label>
          </div>
        </div>

        <!-- Supplier Info -->
        <div class="form-grid-supplier section-divider no-border">
          <div class="form-group code-col">
            <label>仕入先コード</label>
            <div class="input-with-button">
              <div class="relative-wrapper">
                <input type="text" formControlName="supplierCode" class="small-input" />
                <button class="icon-btn" (click)="openSupplierSearch()">
                  <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M9.66797 8.75391C9.84375 8.92969 9.84375 9.22266 9.66797 9.39844L9.375 9.69141C9.19922 9.86719 8.90625 9.86719 8.73047 9.69141L6.94336 7.9043C6.88477 7.8457 6.85547 7.75781 6.85547 7.66992V7.49414C6.24023 7.96289 5.47852 8.25586 4.62891 8.25586C2.60742 8.25586 0.966797 6.61523 0.966797 4.59375C0.966797 2.57227 2.60742 0.931641 4.62891 0.931641C6.65039 0.931641 8.29102 2.57227 8.29102 4.59375C8.29102 5.44336 7.99805 6.20508 7.5293 6.82031H7.70508C7.79297 6.82031 7.88086 6.84961 7.93945 6.9082L9.66797 8.75391ZM4.62891 6.82031C5.85938 6.82031 6.85547 5.82422 6.85547 4.59375C6.85547 3.36328 5.85938 2.36719 4.62891 2.36719C3.39844 2.36719 2.40234 3.36328 2.40234 4.59375C2.40234 5.82422 3.39844 6.82031 4.62891 6.82031Z"
                      fill="white" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div class="form-group name-col">
            <label>&nbsp;</label>
            <input type="text" formControlName="supplierName" />
          </div>
          <div class="form-group lead-time-col">
            <label>リードタイム</label>
            <input type="text" formControlName="leadTime" />
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="modal-footer">
        <button class="delete-btn">削除</button>
        <button class="save-btn" (click)="onSave()" [disabled]="!isFormDirty()">保存</button>
      </div>
    </div>
  </form>
</div>