<div class="header-container" *ngIf="headerFormGroup">
    <div class="top-bar">
        <button class="back-btn" (click)="onBack()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 12L6 8L10 4" stroke="#4392BB" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            戻る
        </button>

        <div class="actions">
            <div class="status-label">
                <span class="status-badge">{{ inputStatusMap[headerFormGroup.get('inputStatus')?.value || '0'] }}</span>
            </div>

            <button class="btn-save" (click)="onSave()" [disabled]="isFormInvalid">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M10.9941 2.48828C11.2227 2.7168 11.375 3.02148 11.375 3.35156V10.1562C11.375 10.8418 10.8164 11.375 10.1562 11.375H1.21875C0.533203 11.375 0 10.8418 0 10.1562V1.21875C0 0.558594 0.533203 0 1.21875 0H8.02344C8.35352 0 8.6582 0.152344 8.88672 0.380859L10.9941 2.48828ZM5.6875 9.75C6.57617 9.75 7.3125 9.03906 7.3125 8.125C7.3125 7.23633 6.57617 6.5 5.6875 6.5C4.77344 6.5 4.0625 7.23633 4.0625 8.125C4.0625 9.03906 4.77344 9.75 5.6875 9.75ZM8.125 2.03125C8.125 1.95508 8.07422 1.87891 8.02344 1.80273L7.94727 1.72656C7.87109 1.67578 7.79492 1.625 7.71875 1.625H1.92969C1.75195 1.625 1.625 1.77734 1.625 1.92969V4.57031C1.625 4.74805 1.75195 4.875 1.92969 4.875H7.82031C7.97266 4.875 8.125 4.74805 8.125 4.57031V2.03125Z"
                        fill="white" />
                </svg>
                保存</button>
        </div>
    </div>

    <div class="form-grid" [formGroup]="headerFormGroup">
        <!-- Row 1 -->
        <div class="form-group">
            <label>入庫予定日</label>
            <div class="input-wrapper date-input">
                <input matInput [matDatepicker]="planDatePicker" formControlName="inputPlanDate" class="date-field">
                <mat-datepicker-toggle matSuffix [for]="planDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #planDatePicker></mat-datepicker>
            </div>
        </div>
        <div class="form-group">
            <label>入庫日</label>
            <div class="input-wrapper date-input"
                [class.invalid-input]="headerFormGroup.get('inputActualDate')?.invalid && headerFormGroup.get('inputActualDate')?.touched">
                <input matInput [matDatepicker]="actualDatePicker" formControlName="inputActualDate" class="date-field">
                <mat-datepicker-toggle matSuffix [for]="actualDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #actualDatePicker></mat-datepicker>
                <div class="error-tooltip"
                    *ngIf="headerFormGroup.get('inputActualDate')?.invalid && headerFormGroup.get('inputActualDate')?.touched">
                    必須項目です。
                </div>
            </div>
        </div>
        <div class="form-group">
            <label>伝票区分</label>
            <select formControlName="createSlipType">
                <option value="0">通常入庫（自動採番）</option>
                <option value="1">通常入庫（手動採番）</option>
            </select>
        </div>
        <div class="form-group">
            <label>伝票番号</label>
            <input type="text" [attr.disabled]="headerFormGroup.get('createSlipType')?.value === '0' ? true : null"
                formControlName="slipNo">
        </div>
        <div class="form-group">
            <label>客先伝票番号</label>
            <input type="text" [attr.disabled]="headerFormGroup.get('isClosed')?.value === '1' ? true : null"
                formControlName="actualSupplierSlipNo">
        </div>

        <!-- Row 2 -->
        <div class="form-group">
            <label>仕入先コード</label>
            <div class="input-wrapper">
                <input type="text" formControlName="destinationCode">
                <button class="search-btn" (click)="openSearchDialog('supplierDelivery')">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-group" style="grid-column: span 4;">
            <label>仕入先名称</label>
            <input type="text" readonly formControlName="departmentName" class="readonly-input">
        </div>

        <!-- Row 3 -->
        <div class="form-group">
            <label>支払先コード</label>
            <div class="input-wrapper">
                <input class="readonly-input" type="text" readonly formControlName="supplierCode">
            </div>
        </div>
        <div class="form-group" style="grid-column: span 4;">
            <label>支払先名称</label>
            <input type="text" readonly formControlName="supplierName" class="readonly-input">
        </div>

        <!-- Row 4 -->
        <div class="form-group">
            <label>所有者コード</label>
            <div class="input-wrapper">
                <input type="text" formControlName="customerCode">
                <button class="search-btn" (click)="openSearchDialog('customer')">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-group">
            <label>所有者名称</label>
            <input type="text" formControlName="customerName" class="readonly-input">
        </div>
        <div class="form-group">
            <label>倉庫</label>
            <select formControlName="actualRepositoryId">
                <option *ngFor="let repo of repositories()" [value]="repo.repositoryId">
                    {{ repo.repositoryCode }} {{ repo.repositoryName }}
                </option>
            </select>
        </div>
        <div class="form-group" style="grid-column: span 2;">
            <label>伝票備考</label>
            <input type="text" formControlName="actualSlipNote">
        </div>
    </div>
</div>
